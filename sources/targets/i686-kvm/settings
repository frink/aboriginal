DESCRIPTION="
Variant of i686 target using kvm with virtio (different kernel/emulator config).
"

# Use the i686 base architecture

base_architecture i686

ROOT=vda
CONSOLE=ttyS0

LINUX_CONFIG="
CONFIG_MPENTIUMII=y
CONFIG_ACPI=y

# VIRTIO_CONSOLE not used yet
CONFIG_SERIAL_8250=y
CONFIG_SERIAL_8250_CONSOLE=y
CONFIG_VIRTIO_CONSOLE=y

CONFIG_HW_RANDOM_VIRTIO=y
CONFIG_PARAVIRT_GUEST=y
CONFIG_VIRTIO_BLK=y
CONFIG_KVM_CLOCK=y
CONFIG_KVM_GUEST=y
"

emulator_command()
{
#  echo qemu -cpu pentium $(qemu_defaults "$@")
  echo "if [ \"\$WITH_HDC\"X\"\" != \"X\" ]; then WITH_HDC=\"-drive file=\$HDC,if=virtio\"; fi"
  echo "if [ \"\$WITH_HDB\"X\"\" != \"X\" ]; then WITH_HDB=\"-drive file=\$HDB,if=virtio\"; fi"
  echo -n "qemu -cpu pentium -nographic -no-reboot -kernel $KERNEL \$WITH_HDC \$WITH_HDB"
  [ "$SYSIMAGE_TYPE" != "initramfs" ] && echo -n " -drive file=$IMAGE,if=virtio"
  echo -n " -append \"$(kernel_cmdline)\" \$QEMU_EXTRA -net nic,model=virtio -net user"
}
